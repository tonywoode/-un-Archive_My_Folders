var vote=function(){var j={informModerator:-1,undoMod:0,acceptedByOwner:1,upMod:2,downMod:3,offensive:4,favorite:5,close:6,reopen:7,deletion:10,undeletion:11,spam:12};var c="View upvote and downvote totals";var k=function(){var w='<a href="/users/login?returnurl='+escape(document.location)+'">login or register</a>';h().click(function(){r($(this),"Please "+w+" to vote for this post.")});u().unbind("click").click(function(){r($(this),"Please "+w+" to flag this post.")})};var v=function(w){if(!w){w="div.vote"}$(w).find(".vote-up-off").unbind("click").click(function(){vote.up($(this))});$(w).find(".vote-down-off").unbind("click").click(function(){vote.down($(this))});$(w).find(".star-off").unbind("click").click(function(){vote.favorite($(this))})};var h=function(w){var x=w?w.closest("div.vote"):$("div.vote");return x.find(".vote-up-off, .vote-down-off, .star-off").unbind("click")};var d=function(w){$.ajax({type:"GET",url:"/posts/"+w+"/votes",dataType:"json",success:s})};var s=function(w){$.each(w,function(){var x=$("div.vote:has(input[value="+this.PostId+"])");switch(this.VoteTypeId){case j.upMod:x.find(".vote-up-off").addClass("vote-up-on");break;case j.downMod:x.find(".vote-down-off").addClass("vote-down-on");break;case j.favorite:x.find(".star-off").addClass("star-on");x.find("div.favoritecount b").addClass("favoritecount-selected");break;default:alert("site.vote.js > highlightExistingVotes has no case for "+this.VoteTypeId);break}});votesCast=null};var n=function(){return $("div.vote span[id^='vote-accepted-']")};var e=function(){return $("div.post-menu a[id^='lock-post-']")};var u=function(){return $("div.post-menu a[id^='flag-post-']")};var l=function(w){return w.hasClass("vote-up-on")};var a=function(w){return w.hasClass("vote-down-on")};var o=function(w){return w.hasClass("star-on")};var g=function(w){return w.parent().find("input").val()};var t=function(x,w){x.removeClass("vote-up-on");w.removeClass("vote-down-on")};var p=function(x,z){var B=x.siblings("span.vote-count-post");var y;if(B.find(".vote-count-separator").length>0){var w=parseInt(B.children(":first").text(),10);var A=Math.abs(parseInt(B.children(":last").text(),10));y=w-A;B.css("cursor","pointer").unbind("click").attr("title",c).click(function(){vote.fetchVoteCounts($(this))})}else{y=parseInt(B.text(),10)}B.text(y+z)};var q=function(y,x){h(y);var w=g(y);m(y,w,x,b)};var m=function(z,x,w,C,B){var A={fkey:fkey};if(B){for(var y in B){A[y]=B[y]}}$.ajax({type:"POST",url:"/posts/"+x+"/vote/"+w,data:A,dataType:"json",success:function(D){C(z,x,D)},error:function(){r(z,"An error has occurred - please retry your request.")}})};var b=function(x,w,y){if(y.Success){if(y.Message){f(x,y.Message)}}else{if(window.console&&window.console.firebug&&(!y.Message||y.Message.length<5)){r(x,"FireBug seems to be enabled, which can sometimes interfere with voting;<br>please refresh the page to see if your vote was processed.<br><br>If this persists, consider disabling FireBug for this site.")}else{r(x,y.Message);t(x,x);x.parent().find("span.vote-count-post").text(y.NewScore);if(y.LastVoteTypeId){i(x,y.LastVoteTypeId)}}}v(x.parent())};var i=function(z,w){var y,x;if(w==j.upMod){y=".vote-up-off";x=".vote-up-on"}else{if(w==j.downMod){y=".vote-down-off";x=".vote-down-on"}}if(y){z.closest("div.vote").find(y).addClass(x)}};var r=function(w,x){var y=$('<div class="error-notification supernovabg"><h2>'+x+"</h2>(click on this box to dismiss)</div>");y.click(function(z){$(".error-notification").fadeOut("fast",function(){$(this).remove()})});w.parent().append(y);y.fadeIn("fast")};var f=function(x,z){var A=$('<div class="error-notification supernovabg"><h2>'+z+"</h2></div>");x.parent().append(A);A.fadeIn("fast");var w=function(){$(".error-notification").fadeOut("fast",function(){$(this).remove()})};var y=Math.max(2500,z.length*40);setTimeout(w,y)};return{init:function(w){if(typeof isRegistered!="undefined"&&isRegistered){if(votesCast==null){d(w)}else{s(votesCast)}v();u().unbind("click").click(function(){vote.flag($(this))})}else{k()}n().unbind("click").click(function(){vote.acceptedAnswer($(this))});var x=$("div.post-menu a[id^='close-question-']");x.unbind("click").click(function(){vote.close(x)});$("div.post-menu a[id^='delete-post-']").unbind("click").click(function(){vote.deletion($(this))})},up:function(z){var A=z.parent().find(".vote-up-off");var y=z.parent().find(".vote-down-off");var x=l(A);var w=a(y);var B=x?-1:(w?2:1);p(z,B);t(A,y);if(!x){A.addClass("vote-up-on")}q(z,x?j.undoMod:j.upMod)},down:function(z){var A=z.parent().find(".vote-up-off");var y=z.parent().find(".vote-down-off");var x=a(y);var w=l(A);var B=x?1:(w?-2:-1);p(z,B);t(A,y);if(!x){y.addClass("vote-down-on")}q(z,x?j.undoMod:j.downMod)},favorite:function(x){var y=x.parent().find("div.favoritecount b");var w=parseInt("0"+y.text().replace(/^\s+|\s+$/g,""),10);if(!o(x)){x.addClass("star-on");y.addClass("favoritecount-selected").text(++w)}else{x.removeClass("star-on");y.removeClass("favoritecount-selected").text((w--<=0)?"":w)}x.unbind("click");m(x,g(x),j.favorite,function(z){x.click(function(){vote.favorite($(this))})})},acceptedAnswer:function(x){if(typeof hasOpenBounty!="undefined"&&hasOpenBounty){var y=($("#"+w+"-is-owned-by-question-owner").length>0)?"Are you sure you want to accept your own answer?  You will STILL LOSE the offered rep and THIS CANNOT BE UNDONE!":"Are you sure you want to accept this answer to your bounty question - THIS CANNOT BE UNDONE!";if(!confirm(y)){return}}if(typeof isBountyQuestion!="undefined"&&isBountyQuestion&&typeof hasOpenBounty=="undefined"){r(x,"You cannot change the accepted answer on a bounty question");return}n().unbind("click");var w=x.attr("id").substring("vote-accepted-".length);m(x,w,j.acceptedByOwner,function(B,z,C){if(C.Success){$(".vote-accepted-off").removeClass("vote-accepted-on");var A=parseInt(C.Message,10);if(A==j.acceptedByOwner){B.addClass("vote-accepted-on");if(typeof hasOpenBounty!="undefined"&&hasOpenBounty){hasOpenBounty=false;$("#bounty-notification").hide()}}else{B.removeClass("vote-accepted-on")}}else{r(B,C.Message)}n().click(function(){vote.acceptedAnswer($(this))})})},flag:function(y){var w=y.attr("id").substring("flag-post-".length);var E="form-flag-"+w;var C=$("#"+w+"-only-allow-inform-moderator-flagging").length>0;var F=[[j.offensive,"Offensive, Abusive, or Hate Speech",!C],[j.spam,"Spam",!C],[j.informModerator,"Requires Moderator attention",true]];var B='<div class="popup flag-menu"><h3>Please flag with care:</h3>';B+='<div class="flag-reasons"><form id="'+E+'">';for(var z=0;z<F.length;z++){if(F[z][2]){var G="flag-radio"+w+"-"+F[z][0];B+='<input type="radio" id="'+G+'" name="flag-'+w+'" value="'+F[z][0]+'">';B+='<label for="'+G+'">'+F[z][1]+"</label><br>"}}B+='<div class="flag-comment">Why are you flagging this post?<textarea name="flag-reason" cols="33" rows="4"></textarea>';B+='<br><span class="text-counter"></span></div>';B+="</form></div>";B+='<input type="button" class="flag-cancel" value="Cancel"><input type="button" class="flag-submit" value="Flag Post">';B+="</div>";var A=$(B);var x=A.find("#"+E);var D=x.find("textarea");x.find("input").click(function(){var H=x.find("div.flag-comment");var I=vote.flagIsInform(x);H.toggle(I);if(I){D.focus()}vote.flagAllowSubmit(A,D,I)});D.charCounter({min:10,max:150,setIsValid:function(){vote.flagAllowSubmit(A,D,vote.flagIsInform(x))}});A.find(".flag-submit").click(function(){if(vote.flagIsInform(x)&&!vote.flagTextValid(D)){return}vote.flagSubmit(y,w,x,D)});A.find(".flag-cancel").click(function(){vote.flagClosePopup(y)});y.parent().append(A);A.fadeIn("fast",function(){if(C){x.find("input").click().click()}})},flagIsInform:function(w){var x=w.find("input:radio:checked");if(x.length==0){return false}return x.val()==j.informModerator},flagAllowSubmit:function(x,y,z){var w=z?vote.flagTextValid(y):true;x.find(".flag-submit").toggle(w)},flagTextValid:function(x){var w=x.val().length;return(w>=10&&w<=150)},flagClosePopup:function(w){w.parent().find(".popup").fadeOut("fast",function(){$(this).remove()})},flagSubmit:function(z,x,w,A){vote.flagClosePopup(z);var y=w.find("input:radio:checked").val();var x=z.attr("id").substring("flag-post-".length);if(y==j.informModerator){$.ajax({type:"POST",url:"/messages/inform-moderator-about-post/"+x,dataType:"json",data:{fkey:fkey,msg:A.val()},success:function(B){showAjaxError(z.parent(),B.Message)},error:function(B,D,C){showAjaxError(z.parent(),(B.responseText&&B.responseText.length<100?B.responseText:"An error occurred during submission"))}})}else{m(z,x,y,vote.flagSubmitCallback,{comment:A.val()})}},flagSubmitCallback:function(x,w,z){if(z&&z.Success){if(z.Message){}}else{var y=x.parent();if(z&&z.Message){showAjaxError(y,z.Message)}else{showAjaxError(y,"A problem occurred during flagging")}}},close:function(x){var y=x.text().indexOf("open")>-1;var w=x.attr("id").substring("close-question-".length);if(y){if(confirm("Nominate this question for reopening?")){m(x,w,j.reopen,vote.close_result)}}else{if(!vote.close_reasons){vote.close_fetchReasons(x,w)}else{vote.close_renderForm(x)}}},close_reasons:null,close_votesRemainingToday:0,close_whenCanVote:"",close_hasVoted:false,close_fetchReasons:function(x,w){$(".error-notification").fadeOutAndRemove();appendLoader(x);$.ajax({type:"GET",url:"/posts/close-reasons/"+w,dataType:"json",success:function(y){removeLoader();vote.close_hasVoted=y.hasVoted;vote.close_votesRemainingToday=y.closeVotesRemainingToday;vote.close_whenCanVote=y.whenCanVote;vote.close_reasons=y.reasons;vote.close_renderForm(x)},error:function(y,A,z){removeLoader();showAjaxError(x.parent(),(y.responseText&&y.responseText.length<100?y.responseText:"An error occurred while fetching close reasons"))}})},close_renderForm:function(A){var y=A.attr("id").substring("close-question-".length);var w="close-popup-"+y;var F="form-close-"+y;var G=!vote.close_hasVoted&&vote.close_votesRemainingToday>0;$("#"+w).remove();var D='<div id="'+w+'" class="popup" style="width:710px"><h2 style="margin-bottom:8px;">'+(vote.close_hasVoted?"You have already voted to close this question":vote.close_votesRemainingToday==0?"You have no more close votes today; come back "+vote.close_whenCanVote:"Why should this question be closed?")+'</h2><ul class="close-reasons">';for(var B=0;B<vote.close_reasons.length;B++){var E=vote.close_reasons[B];var z="close-reason-"+E.id;var x=G?'<input type="radio" id="'+z+'" name="close-'+y+'" value="'+E.id+'">':"";D+="<li><table><tr><td>"+x+'</td><td><label for="'+z+'" class="cp"><span class="close-reason">'+E.name+"</span>"+(E.count>0?' <span class="bounty-indicator-tab" style="margin-left:3px; line-height:20px;" title="this many votes already exist">'+E.count+"</span>":"")+'</label></td></tr><tr><td></td><td class="close-desc">'+E.description+"</td></tr></table></li>"}D+='</ul><input type="button" class="close-cancel" value="Cancel">';if(G){D+='<table class="close-submit-container"><tbody><tr><td><span class="bounty-indicator-tab">'+vote.close_votesRemainingToday+"</span> vote"+(vote.close_votesRemainingToday==1?"":"s")+' remaining</td><td><input type="button" class="close-submit" value="Vote to Close" disabled="disabled"></td></tr></tbody></table>'}D+="</div>";var C=$(D);C.find('input[type="radio"]').click(function(){C.find(".close-submit").removeAttr("disabled").css("cursor","pointer")});C.find(".close-submit").click(function(){vote.close_reasonClick(A,C,y)});C.find(".close-cancel").click(function(){C.fadeOutAndRemove()});C.find("td.close-desc").click(function(){$(this).closest("li").find("input").click()});if(!G){C.find("td, label").css("cursor","auto")}A.parent().append(C);C.fadeIn("fast")},close_reasonExactDuplicateId:1,close_hasLinkedDuplicateQuestions:false,close_reasonClick:function(x,y,w){var z=y.find('input[type="radio"]:checked').val();if(z==vote.close_reasonExactDuplicateId){vote.close_duplicateForm(x,y,w)}else{y.fadeOutAndRemove();appendLoader(x);m(x,w,j.close,vote.close_result,{"close-reason-id":z})}},close_duplicateForm:function(z,B,x){var A=B.find(".close-submit");A.unbind("click").attr("disabled","disabled").css("cursor","default");B.find("h2, ul").remove();B.css("width","490px");var C="duplicate-question-"+x;var y='<div style="padding-bottom:18px"><h2>This question is a duplicate of which other question?</h2><input id="'+C+'" type="text" size="78" style="width:480px"><br><span class="close-duplicate-prompt">Type a question id or title to search for valid targets</span><div class="existing-linked-questions"></div></div>';var w=$(y);w.find("#"+C).autocomplete("/search/duplicate-questions/"+x,{highlightItem:true,matchContains:true,matchSubset:false,scroll:true,scrollHeight:300,formatItem:function(D){A.attr("disabled","disabled").css("cursor","default");var F=D[0];var E=D[1];return(F=="-1")?('<b style="color:#990000">'+E+"</b>"):(F+" - "+E)},formatResult:function(D){var E=D[0];return(E=="-1")?" ":E}}).result(function(E,D){if(D&&D[0]!="-1"){A.removeAttr("disabled","disabled").css("cursor","pointer")}});B.prepend(w);vote.close_showExistingDuplicates(B,x);B.find("#"+C).focus();A.click(function(){B.fadeOutAndRemove();m(z,x,j.close,vote.close_result,{"close-reason-id":vote.close_reasonExactDuplicateId,"duplicate-question-id":$("#"+C).val()})})},close_showExistingDuplicates:function(B,w){var A=false;for(var y=0;y<vote.close_reasons.length;y++){var z=vote.close_reasons[y];if(z.id==vote.close_reasonExactDuplicateId){if(z.count>0){A=true}break}}if(!A){return}var x=B.find("div.existing-linked-questions");appendLoader(x);x.append("<p>Other users chose these questions as the master question:</p>");$.getJSON("/posts/existing-close-duplicate-questions/"+w,function(D){removeLoader();for(var C=0;C<D.length;C++){x.append('<li><a href="'+D[C].url+'" target="_blank">'+D[C].title+"</a></li>")}})},close_result:function(x,w,z){removeLoader();if(z&&z.Success){if(z.Message){var A=x.text().indexOf("open")>-1;x.text(x.text().replace(/\w?\(\d\)/,"")+" "+z.Message);r(x,"This question still needs "+z.NewScore+" vote(s) from other users to "+(A?"reopen":"close"))}else{location.reload(true)}vote.close_reasons=null}else{var y=x.parent();if(z&&z.Message){showAjaxError(y,z.Message)}else{showAjaxError(y,"A problem occurred during closing/reopening")}}},deletion:function(y){var w=y.attr("id").substring("delete-post-".length);var x=y.text().indexOf("undelete")>-1;if(confirm("Vote to "+(x?"un":"")+"delete this post?")){m(y,w,(x?j.undeletion:j.deletion),vote.deletionCallback)}},deletionCallback:function(z,y,A){var B=z.text().indexOf("undelete")>-1;if(A&&A.Success){z.text(A.Message);if(A.NewScore<0){var x=$("#question:has(a[id='delete-post-"+y+"'])").length>0;var w=x?"#question, div.answer":"#answer-"+y;vote.setDeleteStyles($(w),!B)}else{r(z,"This post still needs "+A.NewScore+" vote(s) from other users to "+(B?"un":"")+"delete")}}else{var C=(A&&A.Message)?A.Message:"A problem occurred during "+(B?"un":"")+"deletion";showAjaxError(z.parent(),C)}},setDeleteStyles:function(x,w){if(w){$("div.question-status:has(span:contains('delete'))").show();x.addClass("deleted-answer").find("a[id^='delete-post-']").addClass("deleted-post").end().find("div[id^='comments-']").addClass("comments-container-deleted").end().find("a[id^='comments-link-']").addClass("comments-link-deleted")}else{document.location.reload(true)}},bountyStart:function(x){var w=$("#question div.vote input:first").val();$.post("/posts/"+w+"/bounty-start",{fkey:fkey,amount:x},function(y){if(y.Success){location.reload(true)}else{r($("#bounty-errors"),y.Message);$("#bounty-submit").attr("disabled","")}},"json")},bindFetchVoteCounts:function(){$(".vote-count-post").attr("title",c).css("cursor","pointer").unbind("click").click(function(){vote.fetchVoteCounts($(this))})},fetchVoteCounts:function(x){var w=x.closest("div.vote").children('input[type="hidden"]').val();appendLoader(x);$.ajax({type:"GET",url:"/posts/"+w+"/vote-counts",dataType:"json",success:function(z){$(".error-notification").fadeOut("fast",function(){$(this).remove()});var y='<div style="color:green">'+z.up+'</div><div class="vote-count-separator"></div><div style="color:maroon">'+z.down+"</div>";x.html(y).unbind("click").css("cursor","default").attr("title",(z.up+" up / "+z.down+" down"))},error:function(y,A,z){removeLoader();showAjaxError(x.parent(),(y.responseText&&y.responseText.length<100?y.responseText:"An error occurred during vote count fetch"))}})}}}();var comments=function(){var p=600;var c=function(q,r){return $("div#comments-"+q+(r||""))};var m=function(q){appendLoader(c(q))};var o=function(){$("a[id^='comments-link-']").unbind("click").click(function(){var q=$(this).attr("id").substr("comments-link-".length);var t=c(q);l(q);t.removeClass("dno");if($(this).text().indexOf("more comment")>-1){d(q,t)}else{var s=200+($('form[id^="add-comment-"] > table').length*2);var r=t.find("tfoot form textarea");r.attr("tabindex",s++);t.find("tfoot form input").attr("tabindex",s);if(!r.closest("form").hasClass(".comment-form-expanded")){r.focus()}}$(this).remove()})};var h=function(){$(".comment-up").click(function(){j($(this),2,"comment-up","comment-up-on",function(r,q){r.closest("tr").siblings("tr").remove();r.parent().siblings().children().remove();r.parent().siblings().append(b(q.NewScore))})}).hover(function(){$(this).addClass("comment-up-on")},function(){$(this).removeClass("comment-up-on")});$(".comment-flag").click(function(){if(confirm("Really flag this comment as noise, offensive or spam?")){j($(this),4,"comment-flag","flag-on",function(r,q){if(q.NewScore==-1){r.parents("tr.comment").remove()}else{r.parents("tr.comment").find("img.comment-up").remove();r.remove()}})}}).hover(function(){$(this).addClass("flag-on")},function(){$(this).removeClass("flag-on")});$("div.comments a.comment-edit").click(function(){g($(this))});$(".comment-delete").click(function(){if(confirm("Really delete this comment?")){j($(this),10,"comment-delete","delete-tag-hover",function(r,q){r.parents("tr.comment").remove()})}}).hover(function(){$(this).addClass("delete-tag-hover")},function(){$(this).removeClass("delete-tag-hover")});$("tr.comment").hover(function(){$(this).addClass("comment-hover").find(".comment-up, .comment-flag, .comment-delete, a.comment-edit-hide").css("visibility","visible")},function(){$(this).removeClass("comment-hover").find(".comment-up, .comment-flag, .comment-delete, a.comment-edit-hide").css("visibility","hidden")})};var f=function(){$("tr.comment").unbind("mouseenter mouseleave");$(".comment-up, .comment-flag, .comment-delete, div.comments a.comment-edit").unbind("click mouseenter mouseleave")};var d=function(q,r){m(q);$.ajax({type:"GET",url:"/posts/"+q+"/comments",dataType:"html",success:function(s){a(q,s)},error:function(s,u,t){removeLoader();showAjaxError(c(q),(s.responseText&&s.responseText.length<100?s.responseText:"An error has occured while fetching comments"))}})};var a=function(q,s){var r=c(q," > table > tbody");if(r.children().length>0){r.children().remove()}r.append(s);f();h();removeLoader()};var b=function(s){var q="";if(s&&s>0){var r=s<5?"":s<=15?"warm":s<=30?"hot":"supernova";q+='<span title="number of \'great comment\' votes received" class="'+r+'">'+s+"</span>"}return q};var e=function(q,t,r,w){var s='<table><tr><td><textarea name="comment" cols="68" rows="3"></textarea></td><td><input type="submit" value="'+t+'"/>'+(r?'<a class="edit-comment-cancel">cancel</a>':"")+'</td></tr><tr><td colspan="2"><span class="text-counter"></span><span class="form-error"></span></td></tr></table>';q.append(s);if(r){q.find(".edit-comment-cancel").click(function(){i($(this))})}var u=false;var v=function(x){u=x};q.find("textarea").charCounter({min:15,max:600,setIsValid:v});q.submit(function(){if(u){disableSubmitButton(q);w(q)}else{q.find("span.text-counter").animate({opacity:0},100,function(){$(this).animate({opacity:1},100)})}return false})};var l=function(q){e($("#add-comment-"+q),"Add Comment",false,k)};var k=function(r){var q=r.attr("id").substr("add-comment-".length);m(q);var s=function(){$(".error-notification").fadeOut("fast",function(){$(this).remove()})};var t=r.find("textarea");var u=t.val();if(!u||$.trim(u)==""){return}$.ajax({type:"POST",url:"/posts/"+q+"/comments",dataType:"html",data:{comment:u,fkey:fkey},success:function(v){s();a(q,v);t.val("").keyup();enableSubmitButton(r)},error:function(v,x,w){removeLoader();s();showAjaxError(r,(v.responseText&&v.responseText.length<100?v.responseText:"An error occurred during comment submission"));enableSubmitButton(r)}})};var g=function(t){var s=t.closest("tr.comment");var q=s.find('form[id^="edit-comment-"]');s.find("td.comment-actions *").hide();s.find("td.comment-text > div").hide();s.find("td:last").addClass("comment-form");e(q,"Save Edits",true,n);var r=q.find("textarea");r.val(q.find("div").text());q.show();r.focus()};var n=function(r){appendLoader(r.parent());var t=r.attr("id").substr("edit-comment-".length);var q=r.closest("div.comments").attr("id").substr("comments-".length);var s=function(){$(".error-notification").fadeOut("fast",function(){$(this).remove()})};var u=r.find("textarea");var v=u.val();if(!v||$.trim(v)==""){return}$.ajax({type:"POST",url:"/posts/comments/"+t+"/edit",dataType:"html",data:{comment:v,fkey:fkey},success:function(w){s();a(q,w)},error:function(w,y,x){removeLoader();s();showAjaxError(r,(w.responseText&&w.responseText.length<100?w.responseText:"An error occurred during comment submission"));enableSubmitButton(r)}})};var i=function(s){var r=s.closest("tr.comment");var q=r.find('form[id^="edit-comment-"]');q.children("table").remove();q.hide();r.find("td:last").removeClass("comment-form");r.find("td.comment-actions *").show();r.find("td.comment-text > div").show()};var j=function(v,s,u,w,r){var t=v.parents("tr.comment").attr("id").substr("comment-".length);$("div.error-notification").hide();v.removeClass(u).unbind("click mouseenter mouseleave").addClass(w);appendLoader(v.parent());var q=function(){v.removeClass(w).addClass(u).click(function(){j(v,s,u,w,r)})};$.ajax({type:"POST",url:"/posts/comments/"+t+"/vote/"+s,dataType:"json",data:{fkey:fkey},success:function(x){if(x.Success){r(v,x)}else{showAjaxError(v.parent(),x.Message);q()}},error:function(x,z,y){showAjaxError(v.parent(),(x.responseText&&x.responseText.length<100?x.responseText:"An error occurred during voting"));q()}});removeLoader()};return{init:function(){o();h();$("form.comment-form-expanded").closest("div.comments").siblings("a.comments-link").click()}}}();$.fn.selectRange=function(b,a){return this.each(function(){if(this.setSelectionRange){this.focus();this.setSelectionRange(b,a)}else{if(this.createTextRange){var c=this.createTextRange();c.collapse(true);c.moveEnd("character",a);c.moveStart("character",b);c.select()}}})};function editorReady(b,a){$.get("/questions/ticks",function(c){$("#edit-block").append("<input type='hidden' name='i1l' value='"+c+"' />")});if($("#show-editor-button").length==0&&$("#wmd-preview").length!=0){initPostEditor(b,a)}}function initPostEditor(e,c){var b=$("#post-form");var a=$("#wmd-input");var d=$("#title, #tagnames, #edit-comment, #m-address");b.submit(function(){var f=true;var g=function(h){f=h};$(".edit-field-overlayed").removeClass(".edit-field-overlayed").val("");if(f){disableSubmitButton(b);setConfirmUnload(null)}return f});$("#original-question").not(".processed").TextAreaResizer();a.not(".processed").TextAreaResizer();a.typeWatch({highlight:false,wait:5000,captureLength:5,callback:styleCode});Attacklab.wmdBase();Attacklab.Util.startEditor();if(e){heartbeat.heartbeatNamespace=c;a.keypress(heartbeat.start)}d.blur(function(){var f=$(this).parent().find("span.edit-field-overlay");if(f.length>0){setOverlay(f)}}).keydown(clearOverlay).bind("contextmenu",clearOverlay);$("span.edit-field-overlay").each(function(){setOverlay($(this))});a.keypress(initNavPrevention);$("#wmd-preview").click(function(){a.focus()});if($("#ask-error-container").length==0){$("#title").selectRange(0,0)}d.focus(function(){if($(this).hasClass("edit-field-overlayed")){$(this).selectRange(0,0)}})}var setOverlay=function(a){var b=a.parent().find('input[type="text"]');if(b.val().length==0||b.val()==a.text()){b.val(a.text()).addClass("edit-field-overlayed")}};var invalidElements=function(){var b=[];var a=function(c){return c.attr("name")};return{add:function(e){var c=a(e);var f=true;for(var d=0;d<b.length;d++){if(b[d]==c){f=false;break}}if(f){b.push(c)}},remove:function(e){var c=a(e);for(var d=0;d<b.length;d++){if(b[d]==c){b.splice(d,1)}}},any:function(){return b.length>0}}}();function clearOverlay(){if($(this).val()==$(this).siblings("span.edit-field-overlay").html()){$(this).val("");if($(this).hasClass("edit-field-overlayed")){$(this).removeClass("edit-field-overlayed").val("")}}}function initNavPrevention(a){if(a.which=="undefined"){return}var b=$("#wmd-input");b.unbind("keypress",initNavPrevention);setConfirmUnload("You have started writing or editing a post.",b)}var heartbeat=function(){var d=1000*45;var b;var e=0;var a=false;var c=0;return{heartbeatNamespace:null,start:function(f){if(f.which=="undefined"){return}if(e++>0){return}$("#wmd-input").unbind("keypress",heartbeat.start);heartbeat.heartbeatNamespace.init();setTimeout(heartbeat.heartbeatNamespace.ping,d)},answers:function(){return{name:"heartbeat.answers",init:function(){b=location.href.match(/\/questions\/(\d+)/i)[1]},ping:function(){var f="";$("div.answer").each(function(){f+=this.id.substring("answer-".length)+" "});$.post("/posts/"+b+"/answer-activity-heartbeat",{answerIds:f},heartbeat.answers.result,"json")},result:function(g){var f=++c<30;if(g&&!a){if(g.NoPosting){var h="This question has been "+g.Msg+" - no more answers will be accepted.";notify.show(h);a=true;disableSubmitButton("#post-form");setConfirmUnload(null);f=false}else{if(g.Result){var h=g.Count+" new answer"+(g.Count==1?" has":"s have")+" been posted - ";h+='<a onclick="heartbeat.answers.update()">load new answers.</a>';notify.show(h);a=true}}}if(f){setTimeout(heartbeat.answers.ping,d)}},update:function(){var f=[];$.get("/questions/"+b,function(i){var l=$(i);l.find("div.answer").each(function(){var m=this.id.substring("answer-".length);if($("#answer-"+m).length==0){f.push(this.id)}});if(f.length>0){var h="#"+f.join(",#");var k=l.find(h);var g=$("div.answer:last");if(g.length==0){g=$("#answers-header")}k.hide();g.after(k);k.fadeIn("slow");var j=$("div.answer").length;$(".subheader h2").text(j+" Answer"+(j>1?"s":""));vote.init(b);comments.init()}notify.close();a=false},"html")}}}(),edits:function(){return{name:"heartbeat.edits",init:function(){b=$("#post-id").val()},ping:function(){$.post("/posts/"+b+"/edit-activity-heartbeat",{currentRevisionGuid:$("#current-revision-guid").val()},heartbeat.edits.result,"json")},result:function(g){var f=++c<30;if(g&&!a){if(g.message){if($("#notify-table td.notify").text()!=g.message){notify.close();notify.show(g.message)}setConfirmUnload(null);if(!g.success){disableSubmitButton("#post-form");f=false}}}if(f){setTimeout(heartbeat.edits.ping,d)}},update:function(){}}}()}}();(function(a){a.fn.typeWatch=function(d){var b=a.extend({wait:750,callback:function(){},highlight:true,captureLength:2},d);function c(h,g){var f=a(h.el).val();if((f.length>b.captureLength&&f.toUpperCase()!=h.text)||(g&&f.length>b.captureLength)){h.text=f.toUpperCase();h.cb(f)}}function e(g){if(g.type.toUpperCase()=="TEXT"||g.nodeName.toUpperCase()=="TEXTAREA"){var h={timer:null,text:a(g).val().toUpperCase(),cb:b.callback,el:g,wait:b.wait};if(b.highlight){a(g).focus(function(){this.select()})}var f=function(i){var l=h.wait;var k=false;if(i.keyCode==13&&this.type.toUpperCase()=="TEXT"){l=1;k=true}var j=function(){c(h,k)};clearTimeout(h.timer);h.timer=setTimeout(j,l)};a(g).keydown(f)}}return this.each(function(f){e(this)})}})(jQuery);(function(c){var h,i;var d=0;var a=32;var e;c.fn.TextAreaResizer=function(){return this.each(function(){h=c(this).addClass("processed"),i=null;c(this).parent().append(c('<div class="grippie"></div>').bind("mousedown",{el:this},b));var k=c("div.grippie",c(this).parent())[0];k.style.marginRight=(k.offsetWidth-c(this)[0].offsetWidth)+"px"})};function b(k){h=c(k.data.el);h.blur();d=j(k).y;i=h.height()-d;h.css("opacity",0.25);c(document).mousemove(g).mouseup(f);return false}function g(m){var k=j(m).y;var l=i+k;if(d>=(k)){l-=5}d=k;l=Math.max(a,l);h.height(l+"px");if(l<a){f(m)}return false}function f(k){c(document).unbind("mousemove",g).unbind("mouseup",f);h.css("opacity",1);h.focus();h=null;i=null;d=0}function j(k){return{x:k.clientX+document.documentElement.scrollLeft,y:k.clientY+document.documentElement.scrollTop}}})(jQuery);